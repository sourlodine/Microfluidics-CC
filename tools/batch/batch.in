#! /bin/bash

BATCH_CMD=@BATCH_CMD@
BATCH_PREFIX="SBATCH"
EXE_PREFIX=@EXE_PREFIX@

usage() {
    cat <<EOF
batch submission wrapper for YMeRo
automatically loads the required modules and launch a given batch script.

usage: $EXE_PREFIX.batch <batch file>
EOF
    exit 1
}

if test $# -ne 0 && test "$1" = -h;     then usage; fi
if test $# -ne 0 && test "$1" = --help; then usage; fi

batch_options="#/bin/bash -l"

while test $# -ne 0; do
    arg=$1
    if test $# -eq 1; then
	batch_script=$arg
    else
	batch_options="${batch_options}
# ${BATCH_PREFIX} ${arg}"
    fi
    shift
done

. $EXE_PREFIX.load

if test ! -z "${DRYRUN+x}"; then
    batch_cmd=cat
else
    batch_cmd=$BATCH_CMD
fi

file_content=`cat $batch_script`

exec $batch_cmd <<EOF
$batch_options

$file_content
EOF
